<%- include('../partials/header') %> <%- include('../partials/navbar') %>

<div class="container mt-4">
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    rel="stylesheet"
  />

  <div class="container py-4">
    <!-- Header Section -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="h3 mb-0">Dashboard Overview</h1>
        <p class="text-muted small mb-0">Welcome back, Admin</p>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-primary btn-sm">
          <i class="fas fa-bell me-1"></i> Notifications
        </button>
        <button class="btn btn-primary btn-sm">
          <i class="fas fa-plus me-1"></i> New Project
        </button>
      </div>
    </div>

    <!-- Stats Cards Row -->
    <div class="row g-3 mb-4">
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h6 class="text-muted mb-2">Total Users</h6>
                <h3 class="mb-0">8,549</h3>
                <small class="text-success">
                  <i class="fas fa-arrow-up me-1"></i>12.5%
                </small>
              </div>
              <div class="bg-primary bg-opacity-10 p-3 rounded">
                <i class="fas fa-users text-primary"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h6 class="text-muted mb-2">Revenue</h6>
                <h3 class="mb-0">$24,890</h3>
                <small class="text-success">
                  <i class="fas fa-arrow-up me-1"></i>8.2%
                </small>
              </div>
              <div class="bg-success bg-opacity-10 p-3 rounded">
                <i class="fas fa-dollar-sign text-success"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h6 class="text-muted mb-2">Orders</h6>
                <h3 class="mb-0">1,236</h3>
                <small class="text-danger">
                  <i class="fas fa-arrow-down me-1"></i>3.1%
                </small>
              </div>
              <div class="bg-warning bg-opacity-10 p-3 rounded">
                <i class="fas fa-shopping-cart text-warning"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-12 col-md-6 col-lg-3">
        <div class="card border-0 shadow-sm">
          <div class="card-body">
            <div class="d-flex justify-content-between align-items-center">
              <div>
                <h6 class="text-muted mb-2">Growth</h6>
                <h3 class="mb-0">15.3%</h3>
                <small class="text-success">
                  <i class="fas fa-arrow-up me-1"></i>5.8%
                </small>
              </div>
              <div class="bg-info bg-opacity-10 p-3 rounded">
                <i class="fas fa-chart-line text-info"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content Area -->
    <div class="row g-3">
      <!-- Activity Timeline -->
      <div class="col-12 col-lg-8">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-0">
            <div class="d-flex justify-content-between align-items-center">
              <h5 class="mb-0">Recent Activity</h5>
              <button class="btn btn-link text-decoration-none p-0">
                View All
              </button>
            </div>
          </div>
          <div class="card-body">
            <div class="timeline">
              <div class="d-flex mb-3">
                <div class="flex-shrink-0">
                  <div class="bg-primary bg-opacity-10 p-2 rounded">
                    <i class="fas fa-user-plus text-primary"></i>
                  </div>
                </div>
                <div class="flex-grow-1 ms-3">
                  <h6 class="mb-1">New user registered</h6>
                  <p class="text-muted small mb-0">2 minutes ago</p>
                </div>
              </div>
              <div class="d-flex mb-3">
                <div class="flex-shrink-0">
                  <div class="bg-success bg-opacity-10 p-2 rounded">
                    <i class="fas fa-check text-success"></i>
                  </div>
                </div>
                <div class="flex-grow-1 ms-3">
                  <h6 class="mb-1">Project milestone completed</h6>
                  <p class="text-muted small mb-0">1 hour ago</p>
                </div>
              </div>
              <div class="d-flex">
                <div class="flex-shrink-0">
                  <div class="bg-warning bg-opacity-10 p-2 rounded">
                    <i class="fas fa-bell text-warning"></i>
                  </div>
                </div>
                <div class="flex-grow-1 ms-3">
                  <h6 class="mb-1">New feature release</h6>
                  <p class="text-muted small mb-0">2 hours ago</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="col-12 col-lg-4">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-white border-0">
            <h5 class="mb-0">Quick Actions</h5>
          </div>
          <div class="card-body">
            <div class="d-grid gap-2">
              <button class="btn btn-outline-primary">
                <i class="fas fa-plus me-2"></i>Add New Project
              </button>
              <button class="btn btn-outline-success">
                <i class="fas fa-users me-2"></i>Manage Team
              </button>
              <button class="btn btn-outline-info">
                <i class="fas fa-cog me-2"></i>Settings
              </button>
              <button class="btn btn-outline-warning">
                <i class="fas fa-file-alt me-2"></i>Generate Report
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <h1 class="mb-4">Tableau de bord</h1>

  <!-- Statistiques -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="card bg-primary text-white">
        <div class="card-body">
          <h5 class="card-title">Solde Total</h5>
          <h3 class="card-text">€<%= balance || 0 %></h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white">
        <div class="card-body">
          <h5 class="card-title">Revenus du mois</h5>
          <h3 class="card-text">€<%= monthlyIncome || 0 %></h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-danger text-white">
        <div class="card-body">
          <h5 class="card-title">Dépenses du mois</h5>
          <h3 class="card-text">€<%= monthlyExpenses || 0 %></h3>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white">
        <div class="card-body">
          <h5 class="card-title">Budget restant</h5>
          <h3 class="card-text">€<%= remainingBudget || 0 %></h3>
        </div>
      </div>
    </div>
  </div>

  <!-- Graphiques -->
  <div class="row mb-4">
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Dépenses par catégorie</h5>
          <canvas id="expensesChart"></canvas>
        </div>
      </div>
    </div>
    <div class="col-md-6">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title">Évolution des dépenses</h5>
          <canvas id="trendChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- Transactions récentes -->
  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h5 class="mb-0">Transactions récentes</h5>
      <a href="/transactions" class="btn btn-primary btn-sm">Voir tout</a>
    </div>
    <div class="card-body">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th>Date</th>
              <th>Description</th>
              <th>Catégorie</th>
              <th>Montant</th>
              <th>Type</th>
            </tr>
          </thead>
          <tbody>
            <% if (transactions && transactions.length > 0) { %> <%
            transactions.forEach(transaction => { %>
            <tr>
              <td><%= new Date(transaction.date).toLocaleDateString() %></td>
              <td><%= transaction.description %></td>
              <td><%= transaction.category %></td>
              <td
                class="<%= transaction.type === 'income' ? 'text-success' : 'text-danger' %>"
              >
                €<%= transaction.amount %>
              </td>
              <td>
                <span
                  class="badge bg-<%= transaction.type === 'income' ? 'success' : 'danger' %>"
                >
                  <%= transaction.type === 'income' ? 'Revenu' : 'Dépense' %>
                </span>
              </td>
            </tr>
            <% }); %> <% } else { %>
            <tr>
              <td colspan="5" class="text-center">
                Aucune transaction récente
              </td>
            </tr>
            <% } %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Scripts pour les graphiques -->
<script>
  // Données pour le graphique des dépenses par catégorie
  const expensesCtx = document.getElementById("expensesChart").getContext("2d");
  new Chart(expensesCtx, {
    type: "pie",
    data: {
      labels: ["Alimentation", "Transport", "Logement", "Loisirs", "Autres"],
      datasets: [
        {
          data: [30, 20, 25, 15, 10],
          backgroundColor: [
            "#FF6384",
            "#36A2EB",
            "#FFCE56",
            "#4BC0C0",
            "#9966FF",
          ],
        },
      ],
    },
  });

  // Données pour le graphique d'évolution
  const trendCtx = document.getElementById("trendChart").getContext("2d");
  new Chart(trendCtx, {
    type: "line",
    data: {
      labels: ["Jan", "Fév", "Mar", "Avr", "Mai", "Juin"],
      datasets: [
        {
          label: "Revenus",
          data: [1200, 1300, 1250, 1400, 1350, 1500],
          borderColor: "#28a745",
          tension: 0.1,
        },
        {
          label: "Dépenses",
          data: [1000, 1100, 1050, 1200, 1150, 1300],
          borderColor: "#dc3545",
          tension: 0.1,
        },
      ],
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true,
        },
      },
    },
  });
</script>

<%- include('../partials/footer') %>
